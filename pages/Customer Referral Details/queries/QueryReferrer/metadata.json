{
  "pluginType": "DB",
  "pluginId": "postgres-plugin",
  "unpublishedAction": {
    "name": "QueryReferrer",
    "datasource": {
      "name": "Prod Postgres Reader",
      "pluginId": "postgres-plugin",
      "messages": [],
      "isAutoGenerated": false,
      "id": "Prod Postgres Reader",
      "deleted": false,
      "policies": [],
      "userPermissions": []
    },
    "pageId": "Customer Referral Details",
    "actionConfiguration": {
      "timeoutInMillisecond": 10000,
      "paginationType": "NONE",
      "encodeParamsToggle": true,
      "body": "with referrer_transaction_base as (\n    select t.user_id, \n        rpl.amount as referrer_user_amount, \n        rpl.description as referrer_user_description, \n        rpl.created_at as referrer_rewared_received_on,\n        meta_info->'type' as transaction_type, \n        meta_info->'metaInfo'->>'refereeId' as referee_id, \n        meta_info->'metaInfo'->>'refereeCampaignId' as referee_campaign_id,\n        meta_info->'metaInfo'->>'referrerCampaignId' as referrer_campaign_id\n    from rewards.transactions t \n    left join rewards.rewards_point_ledger rpl \n        on t.id = rpl.transaction_id\n    where meta_info->'type'='\"REFERRAL\"'\n)\nselect \n    uic.user_id as referrer_user_id, \n    ce.email_address as referrer_email_address,\n    uic.user_invite_count as referrer_invite_count,\n    r1.referrer_user_amount, \n    r1.referrer_rewared_received_on, \n    \n    ui.user_id as referee_user_id, \n    ui.created_at as referee_created_at, \n    cr.status as referee_status\n    \nfrom user_invite_codes uic \nleft join public.user_invitation ui \n    on cast(uic.id as text) = cast(ui.user_invite_code_id as text)\nleft join public.customer_email ce\n    on uic.user_id = ce.customer_id\n    and ce.email_provider='FMAIL'\nleft join (\n    select ni.user_id, ni.campaign_id, cast(ni.data->>'refereeId' as text) as referee_id, status\n    from campaigns.node_instances ni \n    where ni.campaign_id in (select id from campaigns.campaigns c where c.campaign_type = 'REFERRAL_CAMPAIGN' and c.group_key = 'REFERRER_CAMPAIGN') \n) cr \n    on uic.user_id = cr.user_id\n    and cast(ui.user_id as text) = cr.referee_id\nleft join referrer_transaction_base r1 \n    on uic.user_id = r1.user_id \n    and cast(ui.user_id as text) = cast(r1.referee_id as text)\nwhere uic.user_invite_count>0 and uic.user_id = {{InputFlashUserUUID.inputText}} AND uic.type='REFERRAL'",
      "selfReferencingDataPaths": [],
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ]
    },
    "executeOnLoad": false,
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "isValid": true,
    "invalids": [],
    "messages": [],
    "jsonPathKeys": [
      "InputFlashUserUUID.inputText"
    ],
    "userSetOnLoad": true,
    "confirmBeforeExecute": false,
    "policies": [],
    "userPermissions": []
  },
  "id": "Customer Referral Details_QueryReferrer",
  "deleted": false,
  "gitSyncId": "64bf8f196d35216bd860d71a_6513d89a728f36234b852112"
}